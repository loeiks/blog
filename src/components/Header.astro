---
import { Github, Instagram, Twitter, Volume2, VolumeOff } from "@lucide/astro";
import Link from "~/components/html/Link.astro";
---

<header
  class="p-4 bg-primary w-full flex items-center justify-center sticky top-0"
>
  <div
    class="max-w-maxw w-full flex flex-row items-center content-center text-white"
  >
    <Link href="/" class="hover:underline">
      <span class="block md:hidden">Enes aka @loeiks</span>
      <span class="hidden md:block">Hello! I'm Enes aka @loeiks</span>
    </Link>

    <div class="ml-auto"></div>

    <div id="social-icons" class="flex items-center gap-2 flex-row text-white">
      <Link
        href="https://twitter.com/loeiks_"
        aria-label="loeiks's Twitter profile"
      >
        <Twitter />
      </Link>
      <Link
        href="https://instagram.com/loeiks"
        aria-label="loeiks's Instagram profile"
      >
        <Instagram />
      </Link>
      <Link
        href="https://github.com/loeiks"
        aria-label="loeiks's GitHub profile"
      >
        <Github />
      </Link>
    </div>

    <div class="w-[1px] h-[20px] bg-primary-90 mx-4"></div>

    <button
      id="sound-toggle"
      type="button"
      aria-label="Toggle sound effects"
      style="visibility: hidden;"
      class="cursor-pointer"
    >
      <Volume2 id="icon-on" class="hidden" />
      <VolumeOff id="icon-off" />
    </button>
  </div>
</header>

<script>
  const STORAGE_KEY = "sound-enabled";

  const initSoundToggle = () => {
    const button = document.getElementById("sound-toggle");
    const iconOn = document.getElementById("icon-on");
    const iconOff = document.getElementById("icon-off");

    if (!button || !iconOn || !iconOff) return;

    const updateIcons = (enabled: boolean) => {
      iconOn.classList.toggle("hidden", !enabled);
      iconOff.classList.toggle("hidden", enabled);
      button.style.visibility = "visible";
    };

    const isEnabled = localStorage.getItem(STORAGE_KEY) === "true";
    updateIcons(isEnabled);

    button.addEventListener("click", () => {
      const currentState = localStorage.getItem(STORAGE_KEY) === "true";
      const newState = !currentState;

      localStorage.setItem(STORAGE_KEY, String(newState));
      updateIcons(newState);

      window.dispatchEvent(
        new CustomEvent("sound-toggle", { detail: { enabled: newState } }),
      );
    });
  };

  initSoundToggle();
  document.addEventListener("astro:after-swap", initSoundToggle);
</script>
